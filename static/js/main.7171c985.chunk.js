(this["webpackJsonpaimer-react"]=this["webpackJsonpaimer-react"]||[]).push([[0],{15:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r,c,a,i,u,o,s=n(0),l=n.n(s),h=n(8),d=n.n(h),j=(n(15),n(5)),f=n(2),b=n(3),x=n(7),m=n(4),O=n(1),v=m.a.div(r||(r=Object(b.a)(["\n"]))),p=function(e){var t=e.openGameScreen,n=Object(s.useContext)(S),r=(n.state,n.dispatch);return Object(O.jsx)(v,{children:Object(O.jsx)("button",{onClick:function(){r({type:"startGame",payload:{enemies:[{name:"Slime",hp:100,maxHP:100,dmg:10,xp:50}]}}),t()},children:"Dungeon 1"})})},g=n(22),y=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)},E=function(e,t){var n=Object(s.useRef)({values:t,handler:function(){for(var t=arguments.length,r=new Array(t),c=0;c<t;c++)r[c]=arguments[c];return e.apply(void 0,r.concat([n.current.values]))}});return n.current.values=t,n.current.handler},I=m.a.div(c||(c=Object(b.a)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100px;\n  background-color: white;\n  padding: 24px;\n  h1 {\n    font-size: 16px;\n  }\n"]))),w=m.a.div(a||(a=Object(b.a)(["\n  position: relative;\n  width: calc(100% - 48px);\n  height: 50px;\n  text-align: center;\n  line-height: 50px;\n  border: 1px solid #666;\n"]))),P=m.a.div(i||(i=Object(b.a)(["\n  ","\n  background-color: red;\n  position: absolute;\n  height: 100%;\n  top: 0;\n"])),(function(e){var t=e.percent;return{width:"".concat(Math.floor(100*t),"%")}})),L=m.a.div(u||(u=Object(b.a)(["\n  z-index: 2;\n  position: relative;\n"]))),k=function(e){var t=e.screenHandle,n=Object(s.useContext)(S),r=n.state,c=n.dispatch,a=Object(s.useRef)(null),i=Object(s.useState)(),u=Object(j.a)(i,2),o=u[0],l=u[1],h=Object(s.useState)(),d=Object(j.a)(h,2),f=d[0],b=d[1],x=Object(s.useRef)({x:100,y:100}),m=Object(s.useRef)([]),v=Object(s.useRef)(r);Object(s.useEffect)((function(){v.current=r}),[r]),Object(s.useEffect)((function(){var e=a.current;l(e);var n=a.current.getContext("2d");b(n);var r=window,c=r.innerWidth,i=r.innerHeight;return a.current.width=c,a.current.height=i,e.requestPointerLock(),document.addEventListener("pointerlockchange",(function(){return C(e)}),!1),document.addEventListener("click",p),function(){document.exitPointerLock(),t.exit()}}),[]),Object(s.useEffect)((function(){var e;return o&&f&&(e=g.a(R)),function(){return e&&e.stop()}}),[o,f]);var p=function(){var e=x.current.x,t=x.current.y,n=m.current,r=n.filter((function(n){var r=n.x,c=n.y,a=n.width,i=n.height;return!(e+5>=r&&e-5<=r+a&&t+5>=c&&t-5<=c+i)}));r.length===n.length||(m.current=r,c({type:"damageEnemy"}))},k=function(e,t){var n;t.fillStyle="grey",t.fillRect(0,0,e.width,e.height),function(e){m.current.forEach((function(t){var n=t.x,r=t.y,c=t.width,a=t.height;e.fillStyle="yellow",e.fillRect(n,r,c,a)}))}(t),t.fillStyle="#f00",t.beginPath(),t.arc(x.current.x,x.current.y,5,0,(n=360,Math.PI/180*n),!0),t.fill(),t.closePath()},R=E((function(e,t){var n=Object(j.a)(t,2),r=n[0],c=n[1];r&&c&&(!function(e){if(!m.current.length&&e){var t=e.width,n=e.height,r=y(t/2-t/4,t-50-t/2),c=y(n/2-n/4,n-50-n/2);m.current=[{x:r,y:c,width:50,height:50}]}}(r),k(r,c))}),[o,f]),C=function(e){document.pointerLockElement!==e&&document.mozPointerLockElement!==e||e.addEventListener("mousemove",(function(e){return M(e)}),!1)},M=E((function(e,t){var n=Object(j.a)(t,2),r=n[0],c=n[1];if(c){var a=r.current,i=a.x,u=a.y;if(i>c.width)r.current={x:c.width-1,y:u};else if(u>c.height)r.current={x:i,y:c.height-1};else if(i<0)r.current={x:1,y:u};else if(u<0)r.current={x:i,y:1};else{var o=.4*e.movementX,s=.4*e.movementY;r.current={x:i+o,y:u+s}}}}),[x,o]),N=r.enemies[r.currentEnemyIdx];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("canvas",{ref:a}),N&&Object(O.jsxs)(I,{children:[Object(O.jsxs)("h1",{children:[N.name,", Damage: ",N.damage,", XP Gained on Kill: ",N.xp]}),Object(O.jsxs)(w,{children:[Object(O.jsxs)(L,{children:[N.hp," / ",N.maxHP]}),Object(O.jsx)(P,{percent:N.hp/N.maxHP})]})]})]})},R=m.a.div(o||(o=Object(b.a)(["\n"]))),S=l.a.createContext(),C={status:"INITIAL"},M=function(e,t){switch(console.log(e),t.type){case"startGame":return Object(f.a)(Object(f.a)({},e),{},{status:"RUNNING",enemies:t.payload.enemies,currentEnemyIdx:0});case"nextEnemy":return Object(f.a)(Object(f.a)({},e),{},{currentEnemyIdx:e.currentEnemyIdx+1});case"damageEnemy":var n=e.enemies,r=e.currentEnemyIdx,c=n[r],a=n.slice(),i=Math.max(c.hp-10,0);console.log(i),a[r]=Object(f.a)(Object(f.a)({},c),{},{hp:i});var u=i?r:r+1;return u>=n.length?{status:"COMPLETED"}:(console.log(a),Object(f.a)(Object(f.a)({},e),{},{enemies:a,currentEnemyIdx:u}));case"endGame":return Object(f.a)(Object(f.a)({},e),{},{status:"INITIAL"});default:return e}},N=function(){var e=Object(s.useReducer)(M,C),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(x.b)();return Object(O.jsx)(S.Provider,{value:{state:n,dispatch:r},children:Object(O.jsxs)(R,{children:["INITIAL"===n.status&&Object(O.jsx)(p,{openGameScreen:c.enter}),Object(O.jsx)(x.a,{handle:c,children:"RUNNING"===n.status&&c.active&&Object(O.jsx)(k,{screenHandle:c})})]})})},G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,23)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};d.a.render(Object(O.jsx)(l.a.StrictMode,{children:Object(O.jsx)(N,{})}),document.getElementById("root")),G()}},[[20,1,2]]]);
//# sourceMappingURL=main.7171c985.chunk.js.map